# Feature Specification: MemoLogy Meme Generation & UX Foundation

**Feature Branch**: `001-memology-infinity-scroll`  
**Created**: 2025-10-14  
**Status**: Draft  
**Input**: User description: "Нужно создать сайт 'MemoLogy' ... (см. исходный запрос)"

## User Scenarios & Testing *(mandatory – aligns with Principles 2 & 3)*

<!--
  IMPORTANT: User stories should be PRIORITIZED as user journeys ordered by importance.
  Each user story/journey must be INDEPENDENTLY TESTABLE - meaning if you implement just ONE of them,
  you should still have a viable MVP (Minimum Viable Product) that delivers value.
  
  Assign priorities (P1, P2, P3, etc.) to each story, where P1 is the most critical.
  Think of each story as a standalone slice of functionality that can be:
  - Developed independently
  - Tested independently
  - Deployed independently
  - Demonstrated to users independently
-->

### User Story 1 - Просмотр бесконечной ленты мемов (Priority: P1)

Пользователь заходит на главную страницу и видит masonry сетку мемов с виртуализацией и бесконечной подгрузкой; может фильтровать/искать/сортировать.

**Why this priority**: Ядро ценности платформы — быстрый просмотр и открытие мемов.

**Independent Test**: Загрузить главную страницу, выполнить поиск по ключевому слову и пролистать вниз до ≥3 порций догрузки без ощутимых лагов.

**Acceptance Scenarios**:

1. **Given** начальная страница без параметров, **When** пользователь скроллит до низа видимой области, **Then** подгружается следующая порция мемов и masonry перестраивается без скачков layout (CLS условно <0.1).
2. **Given** введён поисковый запрос, **When** пользователь нажимает Enter, **Then** лента обновляется релевантными мемами, индикатор загрузки отображается пока идёт поиск.
3. **Given** установлен вид сортировки (например, «Популярные»), **When** пользователь переключает сортировку на «Новые», **Then** контент обновляется соответствующим порядком с reset позиции скролла к началу.
4. **Given** сеть медленная, **When** запрос выполняется >500мс, **Then** показывается skeleton/loader блоки вместо пустого пространства.

---

### User Story 2 - Генерация мемов (text-to-image & image-to-image) (Priority: P1)

Пользователь открывает страницу генерации: слева настраивает параметры (размер, количество, модель, промпт, стиль, режим), справа видит галерею последних сгенерированных.

**Why this priority**: Создание контента повышает удержание и уникальность платформы.

**Independent Test**: Выполнить генерацию 1–n изображений с валидным промптом и увидеть их в правой галерее без перезагрузки страницы.

**Acceptance Scenarios**:
1. **Given** пользователь вводит промпт и выбирает размер, **When** нажимает «Generate», **Then** отображается состояние «Generating…» и после успешного ответа новые мемы появляются сверху в правой панели.
2. **Given** режим text-to-image активен, **When** пользователь переключается на image-to-image и загружает исходное изображение, **Then** появляется превью исходного и поле промпта остаётся доступным.
3. **Given** пользователь выбирает количество = 4, **When** генерация завершается, **Then** ровно 4 новых карточки добавляются в список в правильном порядке.
4. **Given** при генерации произошла ошибка, **When** сервер вернул ошибку, **Then** отображается понятное сообщение и кнопка повторить.
5. **Given** ограничение тарифа (20 генерационных запросов в сутки) превышено, **When** пользователь пытается сгенерировать ещё, **Then** показывается уведомление о лимите и генерация не запускается.

---

### User Story 3 - Личная галерея пользователя по датам (Priority: P2)

Авторизованный пользователь открывает свою галерею и видит собственные сгенерированные/сохранённые мемы, сгруппированные по дате создания (секционные заголовки «Сегодня», «Вчера», дата ISO и т.п.), в masonry сетке.

**Why this priority**: Персональная коллекция формирует привязанность и возвращаемость.

**Independent Test**: Создать минимум 2 группы по разным датам (смоделировать данными) и убедиться, что они отображаются и фильтруются независимо от публичной ленты.

**Acceptance Scenarios**:
1. **Given** пользователь авторизован и есть мемы за разные дни, **When** открывает галерею, **Then** отображаются секции по датам с корректным количеством карточек.
2. **Given** пользователь прокручивает вниз, **When** достигает конца текущих секций, **Then** подгружается следующая порция его мемов без дублирования.
3. **Given** пользователь вводит поиск внутри личной галереи, **When** запрос отправлен, **Then** результаты ограничиваются его контентом и группируются только по соответствующим датам найденных мемов.
4. **Given** у пользователя нет мемов, **When** открывает галерею, **Then** показывается дружелюбный пустой экран с CTA «Сгенерировать свой первый мем».

---

### User Story 4 - Управление профилем и темой (Priority: P3)

Пользователь заходит в профиль и может обновить отображаемое имя и аватар; в sidebar переключает тёмную/светлую тему и может выйти из аккаунта.

**Why this priority**: Личный контроль и брендинг повышают доверие; тема улучшает UX.

**Independent Test**: Обновить аватар и имя, переключить тему, перезагрузить страницу – сохранённые настройки применены.

**Acceptance Scenarios**:
1. **Given** открыта страница профиля, **When** пользователь загружает валидный файл аватара (до лимита размера), **Then** отображается новое превью и после сохранения обновляется глобально.
2. **Given** пользователь переключает тему в sidebar, **When** возвращается на главную, **Then** сохранённая тема применяется без мигания.
3. **Given** пользователь нажимает «Logout», **When** операция завершается, **Then** происходит редирект на страницу входа.
4. **Given** имя содержит недопустимые символы, **When** сохраняет профиль, **Then** показывается валидационное сообщение.

### User Story 5 - Аутентификация и регистрация (Priority: P1)

Неавторизованный пользователь попадает на страницу с двумя блоками: слева слоган/бренд-месседж, справа формы входа или регистрации (переключаемые). В регистрации можно указать аватар.

**Why this priority**: Это входной барьер — без него пользователь не получит персональные возможности (генерация привязана к аккаунту).

**Independent Test**: Зарегистрироваться с валидными данными, загрузить аватар, затем войти — доступ к функционалу генерации открыт.

**Acceptance Scenarios**:
1. **Given** пользователь на странице входа, **When** переключается на регистрацию, **Then** отображаются поля (email, пароль, подтверждение?, аватар, имя дисплея — [NEEDS CLARIFICATION: требуется ли поле подтверждения пароля?]).
2. **Given** загружен аватар неподдерживаемого типа или превышен размер, **When** нажимает «Зарегистрироваться», **Then** отображается ошибка и отправка блокируется.
3. **Given** регистрация прошла успешно, **When** пользователь авторизован, **Then** происходит редирект на основную ленту.
4. **Given** неверные учетные данные при входе, **When** отправка формы, **Then** показывается обобщённая ошибка «Неверный email или пароль» без уточнения, что именно неверно.

---

### Edge Cases

- Поток генерации прерывается (отмена пользователем) — должны очиститься индикаторы загрузки, частично полученные результаты не ломают сетку.
- Пустой результат поиска (публичная и личная галерея) — показывается понятное пустое состояние.
- Смена темы во время активной генерации — UI не мигает, состояния загрузки сохраняются.
- Медленная сеть или временный оффлайн — показываются cached мемы (если предусмотрен кэш) или fallback сообщение.
- Загрузка исходного изображения (image-to-image) слишком большого размера — отображается ограничение и предложение сжать/заменить.
- Несовместимые параметры (например, выбранная модель не поддерживает стиль) — UI дизейблит или показывает подсказку.
- Деградация виртуализации (очень маленький viewport / экстремально длинный список) — производительность сохраняется (порог FPS не менее ~55) или выдаётся предупреждение о снижении качества.

## Requirements *(mandatory – map to Principles & measurable gates)*

## Requirements *(mandatory – map to Principles & measurable gates)*

<!--
  ACTION REQUIRED: The content in this section represents placeholders.
  Fill them out with the right functional requirements.
-->

### Functional Requirements

Browsing & Discovery:
- **FR-001**: Система MUST предоставлять бесконечную прокрутку главной ленты с подгрузкой порциями без дублирования элементов.
- **FR-002**: Система MUST поддерживать поиск по ключевым словам с обновлением ленты и сбросом положения скролла.
- **FR-003**: Система MUST поддерживать сортировки: «Новые» (по дате создания DESC) и «Популярные» (определено как последние изображения — эквивалент сортировки по дате создания DESC, возможно будет переименовано позже для ясности).
- **FR-004**: Система MUST виртуализировать отображение карточек для стабильной производительности при больших списках.

Generation:
- **FR-010**: Система MUST позволять ввод промпта для text-to-image генерации.
- **FR-011**: Система MUST позволять загрузить исходное изображение для image-to-image режима.
- **FR-012**: Система MUST позволять выбрать размер из предопределённых пресетов.
- **FR-013**: Система MUST позволять задать количество генерируемых изображений (1..4 за одну операцию).
- **FR-014**: Система MUST позволять выбрать модель генерации из списка поддерживаемых.
- **FR-015**: Система MUST предоставлять опцию выбора «стиля» (набор предопределённых стилей применяемых к промпту).
- **FR-016**: Система MUST отображать прогресс/состояние генерации и обновлять галерею справа по завершении.

User Gallery & Profile:
- **FR-020**: Система MUST отображать личную галерею пользователя с группировкой по датам.
- **FR-021**: Система MUST обеспечивать поиск внутри личной галереи только по пользовательским мемам.
- **FR-022**: Система MUST предоставлять страницу редактирования профиля (аватар, имя отображения).
- **FR-023**: Система MUST сохранять предпочтение темы (светлая/тёмная) между сессиями.

Auth:
- **FR-030**: Система MUST предоставлять форму регистрации с полями email, пароль, (подтверждение пароля? см. ниже), аватар (опционально), имя отображения.
- **FR-031**: Система MUST предоставлять форму входа с email и паролем.
- **FR-032**: Система MUST скрывать защищённые страницы от неавторизованных пользователей (редирект на вход).

Error & State Handling:
- **FR-040**: Система MUST отображать skeleton/placeholders для первоначальной загрузки и догрузок.
- **FR-041**: Система MUST отображать понятные сообщения об ошибках (без раскрытия внутренних деталей) при сбоях генерации или загрузки данных.

SEO / Accessibility / Performance:
- **FR-050**: Каждая основная страница (главная, галерея пользователя, генерация, профиль, auth) MUST предоставлять уникальный title и meta description.
- **FR-051**: Страницы MUST иметь семантические регионы (main, nav, header, footer) и доступность клавиатурой всех интерактивных элементов.
- **FR-052**: Смена темы MUST происходить без значимого layout shift (нет вспышек не-стилизованного контента).
- **FR-053**: Инициализационный JS бандл главной страницы не превышает увеличения порога (см. Конституцию ≤150KB gzip) при добавлении функционала генерации (обосновать при превышении).

Security & Rate Limits:
- **FR-060**: Должно быть ограничение 20 генерационных запросов в сутки для базового пользователя (учёт по количеству запросов, не по суммарному количеству изображений).

Assumptions:
- Локализация пока RU (возможность i18n позже).
- Авторизация стандарт email+пароль (без соц. OAuth на данном этапе).
- Популярность = условно количество лайков (если не уточнено иначе).

All prior clarification markers resolved (Q1=20 запросов/сутки, Q2=«Популярные»=новые, Q3=максимум 4 изображений).

### Key Entities *(include if feature involves data)*

- **Meme**: Представляет сгенерированное или загруженное изображение; атрибуты: id, authorId, createdAt, prompt (text), style, sourceType (text|image), sourceImageRef?, width, height, popularityMetric (лайки/просмотры), tags.
- **User**: Пользовательский профиль; id, email, displayName, avatarUrl, themePreference, dailyGenerationCount.
- **GenerationRequest**: Логическая запись попытки генерации; id, userId, prompt, mode (text|image2image), model, style, sizePreset, quantity, status (pending|success|error|rate-limited), createdAt.
- **StylePreset**: Стиль визуального оформления; id, name, description, promptAugmentation.

Relationships (в концептуальном уровне): User 1..* Meme; User 1..* GenerationRequest; StylePreset 1..* Meme (через поле style).

## Success Criteria *(mandatory – include performance, accessibility, SEO where relevant)*

<!--
  ACTION REQUIRED: Define measurable success criteria.
  These must be technology-agnostic and measurable.
-->

### Measurable Outcomes

- **SC-001**: Пользователь видит первые 20 мемов ≤1.5s после начальной загрузки (при нормальной сети) — perceivable speed.
- **SC-002**: 95% генераций (text-to-image) завершаются ≤15s при стандартных настройках.
- **SC-003**: Успешное отображение новых изображений в правой панели ≤1s после завершения генерации обработки сервером.
- **SC-004**: Виртуализированная прокрутка удерживает FPS ≥55 при списке из ≥1000 мемов (эмуляция тестовыми данными).
- **SC-005**: Accessibility (Lighthouse) ≥95 на всех новых страницах (auth, generation, profile, gallery).
- **SC-006**: SEO score ≥95 для публичных страниц (главная, публичная лента мемов если предусмотрена).
- **SC-007**: CLS на главной ≤0.1, LCP ≤2.5s (p75), INP ≤200ms.
- **SC-008**: Покрытие тестами нового функционала (строки/операторы) ≥85%.
- **SC-009**: ≥80% пользователей успешно завершают регистрацию (минимум один успешный вход) без повторной попытки.
- **SC-010**: Не более 5% генераций завершаются ошибкой не считая rate limit (исключая намеренные отмены).

### Edge Performance / Load Goals (информативно)
- Дополнительный вес initial bundle прирост ≤10KB gzip относительно baseline до внедрения генерации UI (иначе требуется justification).

Status: Некоторые метрики зависят от будущего бекенда и будут уточнены при планировании.
